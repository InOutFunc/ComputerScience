# 进程调度

## 概率、层次

某种规则来决定处理这些任务的顺序

进程的数量往往是多于处理机的个数，从就绪队列中按照一定的算法选择一个进程，并将处理机分配给它运行，实现进程的并发执行

### 调度的三个层次

高级调度：从外存中处于后备队列的作业中挑选一个作业，建立相应的进程（外存-》内存，面向作业）

中级调度：暂时不能运行的进程调至外存等待，挂起状态，挂起队列，pcb会常驻内存（外存-》内存，面向进程）

低级调度：从就绪队列中选取一个进程（内存-》cpu）

## 时机与方式

* 主动放弃处理机
  * 正常终止
  * 发生异常
  * 主动请求阻塞
* 被动放弃
  * 时间片用完
  * 更紧急
  * 更高优先级
* 不能进行进程调度与切换
  * 处理中断
  * 进程在内核程序临界区
  * 原语
* 内核程序临界区
  * 临界资源：一个时间段内只允许一个进程使用的资源
  * 临界区：访问临界资源的那段代码
* 非抢占方式
* 抢占方式

进程切换：

1. 对原来运行进程各种数据的保存
2. 对新的进程各种数据的恢复
3. 进程切换是有代价的

## 评价指标

### cpu利用率

cpu忙碌的时间 / 总时间

### 系统吞吐量

单位时间内完成作业的数量

### 周转时间

作业被提交给系统开始，到作业完成

带权周转时间 = 周转时间 / 实际运行的时间

平均带权周转时间

### 等待时间

等待处理机状态时间之和，等待i/o不计入

### 响应时间

用户提交请求到首次产生响应所用的时间

## 调度算法

1. 算法思想
2. 算法规则
3. 作业调度还是进程调度
4. 抢占式，非抢占式
5. 优点和缺点
6. 是否会导致饥饿

### 先来先服务

1. 公平角度
2. 非抢占式的算法
3. 对长作业有利，对短作业不利
4. 不会导致饥饿

### 短进程优先

1. 追求最少的平均等待时间
2. 非抢占式（但有最短剩余时间优先）：如果新到达的进程剩余时间比当前运行的进程剩余时间更短，则由新进程抢占处理机。
3. 同时开始，“最短的”平均等待时间
4. 对短作业有利，对长作业不利，可能饥饿

### 高响应比优先

响应比 = （等待时间 + 要求服务时间） / 要求服务时间

等待时间相同，服务短的优先

服务时间相同，等待时间长的优先

不会饥饿

### 时间片轮转算法

时间片

抢占式

时钟中断

默认新到达的进程先进入就绪队列

时间片太大，退化为先来先服务

时间片太小，进程切换过于频繁

### 优先级调度算法

紧急程度来决定处理顺序

非抢占式，抢占式

饥饿

### 多级反馈队列调度算法

1. 设置多级就绪队列，队列间优先级从高到低，时间片从小到大
2. 新进程先进入第1级队列，按fcfs排队分配时间片。进入下一级队列队尾。如果已经在最下级的队列，则重新放回最下级队列队尾
3. 只有k级队列为空时，才会为k + 1级对头的进程分配时间片
4. 被抢占处理机的进程重新放回原队列队尾

会饥饿